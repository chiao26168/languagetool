


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > ArabicTagger</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.languagetool.tagging.ar</a>
</div>

<h1>Coverage Summary for Class: ArabicTagger (org.languagetool.tagging.ar)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ArabicTagger</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/232)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/169)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/* LanguageTool, a natural language style checker
&nbsp; * Copyright (C) 2019 Sohaib Afifi, Taha Zerrouki
&nbsp; *
&nbsp; * This library is free software; you can redistribute it and/or
&nbsp; * modify it under the terms of the GNU Lesser General Public
&nbsp; * License as published by the Free Software Foundation; either
&nbsp; * version 2.1 of the License, or (at your option) any later version.
&nbsp; *
&nbsp; * This library is distributed in the hope that it will be useful,
&nbsp; * but WITHOUT ANY WARRANTY; without even the implied warranty of
&nbsp; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
&nbsp; * Lesser General Public License for more details.
&nbsp; *
&nbsp; * You should have received a copy of the GNU Lesser General Public
&nbsp; * License along with this library; if not, write to the Free Software
&nbsp; * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301
&nbsp; * USA
&nbsp; */
&nbsp;package org.languagetool.tagging.ar;
&nbsp;
&nbsp;import morfologik.stemming.DictionaryLookup;
&nbsp;import morfologik.stemming.IStemmer;
&nbsp;import org.jetbrains.annotations.Nullable;
&nbsp;import org.languagetool.AnalyzedToken;
&nbsp;import org.languagetool.AnalyzedTokenReadings;
&nbsp;import org.languagetool.language.Arabic;
&nbsp;import org.languagetool.tagging.BaseTagger;
&nbsp;import org.languagetool.tools.ArabicStringTools;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;import java.util.Locale;
&nbsp;
&nbsp;/**
&nbsp; * @since 4.9
&nbsp; */
&nbsp;public class ArabicTagger extends BaseTagger {
&nbsp;
<b class="nc">&nbsp;  private final ArabicTagManager tagmanager = new ArabicTagManager();</b>
<b class="nc">&nbsp;  private boolean newStylePronounTag = false;</b>
&nbsp;
&nbsp;  public ArabicTagger() {
<b class="nc">&nbsp;    super(&quot;/ar/arabic.dict&quot;, new Locale(&quot;ar&quot;));</b>
&nbsp;  }
&nbsp;
&nbsp;
&nbsp;  @Override
&nbsp;  public List&lt;AnalyzedTokenReadings&gt; tag(List&lt;String&gt; sentenceTokens) {
<b class="nc">&nbsp;    List&lt;AnalyzedTokenReadings&gt; tokenReadings = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;    IStemmer dictLookup = new DictionaryLookup(getDictionary());</b>
<b class="nc">&nbsp;    int pos = 0;</b>
<b class="nc">&nbsp;    for (String word : sentenceTokens) {</b>
<b class="nc">&nbsp;      List&lt;AnalyzedToken&gt; l = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;      String striped = ArabicStringTools.removeTashkeel(word);</b>
<b class="nc">&nbsp;      List&lt;AnalyzedToken&gt; taggerTokens = asAnalyzedTokenListForTaggedWords(word, getWordTagger().tag(striped));</b>
<b class="nc">&nbsp;      addTokens(taggerTokens, l);</b>
&nbsp;      // additional tagging with prefixes
&nbsp;      // if not a stop word add more stemming
<b class="nc">&nbsp;      if (!isStopWord(taggerTokens)) {</b>
&nbsp;        // test all possible tags
<b class="nc">&nbsp;        addTokens(additionalTags(word, dictLookup), l);</b>
&nbsp;      }
<b class="nc">&nbsp;      if (l.isEmpty()) {</b>
<b class="nc">&nbsp;        l.add(new AnalyzedToken(word, null, null));</b>
&nbsp;      }
<b class="nc">&nbsp;      tokenReadings.add(new AnalyzedTokenReadings(l, pos));</b>
<b class="nc">&nbsp;      pos += word.length();</b>
<b class="nc">&nbsp;    }</b>
<b class="nc">&nbsp;    return tokenReadings;</b>
&nbsp;  }
&nbsp;
&nbsp;  @Nullable
&nbsp;  protected List&lt;AnalyzedToken&gt; additionalTags(String word, IStemmer stemmer) {
<b class="nc">&nbsp;    String striped = ArabicStringTools.removeTashkeel(word);</b>
<b class="nc">&nbsp;    List&lt;AnalyzedToken&gt; additionalTaggedTokens = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;    List&lt;Integer&gt; prefix_index_list = getPrefixIndexList(striped);</b>
<b class="nc">&nbsp;    List&lt;Integer&gt; suffix_index_list = getSuffixIndexList(striped);</b>
&nbsp;
<b class="nc">&nbsp;    for (int i : prefix_index_list) {</b>
<b class="nc">&nbsp;      for (int j : suffix_index_list) {</b>
&nbsp;        // avoid default case of returned word as it
<b class="nc">&nbsp;        if ((i == 0) &amp;&amp; (j == striped.length()))</b>
<b class="nc">&nbsp;          continue;</b>
&nbsp;        // get stem return a list, to generate some variants for stems.
<b class="nc">&nbsp;        List&lt;String&gt; stemsList = getStem(striped, i, j);</b>
<b class="nc">&nbsp;        List&lt;String&gt; tags = getTags(striped, i, j);</b>
&nbsp;
<b class="nc">&nbsp;        for (String stem : stemsList) {</b>
&nbsp;          List&lt;AnalyzedToken&gt; taggerTokens;
<b class="nc">&nbsp;          taggerTokens = asAnalyzedTokenList(stem, stemmer.lookup(stem));</b>
&nbsp;
<b class="nc">&nbsp;          for (AnalyzedToken taggerToken : taggerTokens) {</b>
<b class="nc">&nbsp;            String posTag = taggerToken.getPOSTag();</b>
&nbsp;            // modify tags in postag, return null if not compatible
<b class="nc">&nbsp;            posTag = tagmanager.modifyPosTag(posTag, tags);</b>
&nbsp;
<b class="nc">&nbsp;            if (posTag != null)</b>
<b class="nc">&nbsp;              additionalTaggedTokens.add(new AnalyzedToken(word, posTag, taggerToken.getLemma()));</b>
<b class="nc">&nbsp;          } // for taggerToken</b>
<b class="nc">&nbsp;        } // for stem in stems</b>
<b class="nc">&nbsp;      } // for j</b>
<b class="nc">&nbsp;    } // for i</b>
<b class="nc">&nbsp;    return additionalTaggedTokens;</b>
&nbsp;  }
&nbsp;
&nbsp;  private void addTokens(List&lt;AnalyzedToken&gt; taggedTokens, List&lt;AnalyzedToken&gt; l) {
<b class="nc">&nbsp;    if (taggedTokens != null) {</b>
<b class="nc">&nbsp;      l.addAll(taggedTokens);</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;
&nbsp;  private List&lt;Integer&gt; getSuffixIndexList(String possibleWord) {
<b class="nc">&nbsp;    List&lt;Integer&gt; suffix_indexes = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;    suffix_indexes.add(possibleWord.length());</b>
<b class="nc">&nbsp;    int suffix_pos = possibleWord.length();</b>
<b class="nc">&nbsp;    if (possibleWord.endsWith(&quot;ك&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.endsWith(&quot;ها&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.endsWith(&quot;هما&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.endsWith(&quot;كما&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.endsWith(&quot;هم&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.endsWith(&quot;هن&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.endsWith(&quot;كم&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.endsWith(&quot;كن&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.endsWith(&quot;نا&quot;)</b>
&nbsp;    ) {
<b class="nc">&nbsp;      if (possibleWord.endsWith(&quot;ك&quot;))</b>
<b class="nc">&nbsp;        suffix_pos -= 1;</b>
<b class="nc">&nbsp;      else if (possibleWord.endsWith(&quot;هما&quot;) || possibleWord.endsWith(&quot;كما&quot;))</b>
<b class="nc">&nbsp;        suffix_pos -= 3;</b>
&nbsp;      else
<b class="nc">&nbsp;        suffix_pos -= 2;</b>
<b class="nc">&nbsp;      suffix_indexes.add(suffix_pos);</b>
&nbsp;    }
<b class="nc">&nbsp;    return suffix_indexes;</b>
&nbsp;  }
&nbsp;
&nbsp;  private List&lt;Integer&gt; getPrefixIndexList(String possibleWord) {
<b class="nc">&nbsp;    List&lt;Integer&gt; prefix_indexes = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;    prefix_indexes.add(0);</b>
&nbsp;    int prefix_pos;
&nbsp;
&nbsp;    // four letters
<b class="nc">&nbsp;    if (possibleWord.startsWith(&quot;وكال&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;وبال&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;فكال&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;فبال&quot;)</b>
&nbsp;    ) {
<b class="nc">&nbsp;      prefix_pos = 4;</b>
<b class="nc">&nbsp;      prefix_indexes.add(prefix_pos);</b>
&nbsp;    }
&nbsp;
&nbsp;    // three letters
<b class="nc">&nbsp;    if (possibleWord.startsWith(&quot;ولل&quot;) // هذه حالة ول+ال</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;فلل&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;فال&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;وال&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;بال&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;كال&quot;)</b>
&nbsp;    ) {
<b class="nc">&nbsp;      prefix_pos = 3;</b>
<b class="nc">&nbsp;      prefix_indexes.add(prefix_pos);</b>
&nbsp;    }
&nbsp;
&nbsp;    // two letters
<b class="nc">&nbsp;    if (possibleWord.startsWith(&quot;لل&quot;)  // حالة ل+ال أي حرفان زائدان</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;وك&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;ول&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;وب&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;فك&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;فل&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;فب&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;ال&quot;)</b>
&nbsp;      //  حالة الفعل المضارع، السين فقط ما يؤخذ
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;فسأ&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;فسن&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;فسي&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;فست&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;وسأ&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;وسن&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;وسي&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;وست&quot;)</b>
&nbsp;
&nbsp;    ) {
<b class="nc">&nbsp;      prefix_pos = 2;</b>
<b class="nc">&nbsp;      prefix_indexes.add(prefix_pos);</b>
&nbsp;    }
&nbsp;
&nbsp;    // one letter
<b class="nc">&nbsp;    if (possibleWord.startsWith(&quot;ك&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;ل&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;ب&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;و&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;ف&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;سأ&quot;)  //  حالة الفعل المضارع، السين فقط ما يؤخذ</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;سن&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;سي&quot;)</b>
<b class="nc">&nbsp;      || possibleWord.startsWith(&quot;ست&quot;)</b>
&nbsp;    ) {
<b class="nc">&nbsp;      prefix_pos = 1;</b>
<b class="nc">&nbsp;      prefix_indexes.add(prefix_pos);</b>
&nbsp;    }
&nbsp;
&nbsp;    // get prefixe
<b class="nc">&nbsp;    return prefix_indexes;</b>
&nbsp;  }
&nbsp;
&nbsp;
&nbsp;  private List&lt;String&gt; getTags(String word, int posStart, int posEnd) {
<b class="nc">&nbsp;    List&lt;String&gt; tags = new ArrayList&lt;&gt;();</b>
&nbsp;    // extract tags from word
<b class="nc">&nbsp;    String prefix = getPrefix(word, posStart);</b>
<b class="nc">&nbsp;    String suffix = getSuffix(word, posEnd);</b>
&nbsp;    // prefixes
&nbsp;    // first place
<b class="nc">&nbsp;    if (prefix.startsWith(&quot;و&quot;) || prefix.startsWith(&quot;ف&quot;)) {</b>
<b class="nc">&nbsp;      tags.add(&quot;CONJ;W&quot;);</b>
<b class="nc">&nbsp;      prefix = prefix.replaceAll(&quot;^[وف]&quot;, &quot;&quot;);</b>
&nbsp;
&nbsp;    }
&nbsp;    // second place
<b class="nc">&nbsp;    if (prefix.startsWith(&quot;ك&quot;)) {</b>
<b class="nc">&nbsp;      tags.add(&quot;JAR;K&quot;);</b>
<b class="nc">&nbsp;    } else if (prefix.startsWith(&quot;ل&quot;)) {</b>
<b class="nc">&nbsp;      tags.add(&quot;JAR;L&quot;);</b>
<b class="nc">&nbsp;    } else if (prefix.startsWith(&quot;ب&quot;)) {</b>
<b class="nc">&nbsp;      tags.add(&quot;JAR;B&quot;);</b>
<b class="nc">&nbsp;    } else if (prefix.startsWith(&quot;س&quot;)) {</b>
<b class="nc">&nbsp;      tags.add(&quot;ISTIQBAL;S&quot;);</b>
&nbsp;    }
&nbsp;    // last place
<b class="nc">&nbsp;    if (prefix.endsWith(&quot;ال&quot;)</b>
<b class="nc">&nbsp;      || prefix.endsWith(&quot;لل&quot;)</b>
&nbsp;    ) {
<b class="nc">&nbsp;      tags.add(&quot;PRONOUN;D&quot;);</b>
&nbsp;    }
&nbsp;    // suffixes
<b class="nc">&nbsp;    if (!newStylePronounTag) {</b>
<b class="nc">&nbsp;      switch (suffix) {</b>
&nbsp;        case &quot;ني&quot;:
&nbsp;        case &quot;نا&quot;:
&nbsp;        case &quot;ك&quot;:
&nbsp;        case &quot;كما&quot;:
&nbsp;        case &quot;كم&quot;:
&nbsp;        case &quot;كن&quot;:
&nbsp;        case &quot;ه&quot;:
&nbsp;        case &quot;ها&quot;:
&nbsp;        case &quot;هما&quot;:
&nbsp;        case &quot;هم&quot;:
&nbsp;        case &quot;هن&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;H&quot;);</b>
&nbsp;          break;
<b class="nc">&nbsp;      }</b>
&nbsp;    } else // if newStyle
&nbsp;    {
<b class="nc">&nbsp;      switch (suffix) {</b>
&nbsp;        case &quot;ني&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;b&quot;);</b>
<b class="nc">&nbsp;          break;</b>
&nbsp;        case &quot;نا&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;c&quot;);</b>
<b class="nc">&nbsp;          break;</b>
&nbsp;        case &quot;ك&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;d&quot;);</b>
<b class="nc">&nbsp;          break;</b>
&nbsp;        case &quot;كما&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;e&quot;);</b>
<b class="nc">&nbsp;          break;</b>
&nbsp;        case &quot;كم&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;f&quot;);</b>
<b class="nc">&nbsp;          break;</b>
&nbsp;        case &quot;كن&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;g&quot;);</b>
<b class="nc">&nbsp;          break;</b>
&nbsp;        case &quot;ه&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;H&quot;);</b>
<b class="nc">&nbsp;          break;</b>
&nbsp;        case &quot;ها&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;i&quot;);</b>
<b class="nc">&nbsp;          break;</b>
&nbsp;        case &quot;هما&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;j&quot;);</b>
<b class="nc">&nbsp;          break;</b>
&nbsp;        case &quot;هم&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;k&quot;);</b>
<b class="nc">&nbsp;          break;</b>
&nbsp;        case &quot;هن&quot;:
<b class="nc">&nbsp;          tags.add(&quot;PRONOUN;n&quot;);</b>
&nbsp;      }
&nbsp;    }
&nbsp;
&nbsp;
<b class="nc">&nbsp;    return tags;</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * @return test if word has stopword tagging
&nbsp;   */
&nbsp;  private boolean isStopWord(List&lt;AnalyzedToken&gt; taggerTokens) {
&nbsp;    // if one token is stop word
<b class="nc">&nbsp;    for (AnalyzedToken tok : taggerTokens) {</b>
<b class="nc">&nbsp;      if (tok != null &amp;&amp; tagmanager.isStopWord(tok.getPOSTag())) {</b>
<b class="nc">&nbsp;        return true;</b>
&nbsp;      }
<b class="nc">&nbsp;    }</b>
<b class="nc">&nbsp;    return false;</b>
&nbsp;  }
&nbsp;
&nbsp;  private String getPrefix(String word, int pos) {
<b class="nc">&nbsp;    return word.substring(0, pos);</b>
&nbsp;  }
&nbsp;
&nbsp;  private String getSuffix(String word, int pos) {
<b class="nc">&nbsp;    return word.substring(pos);</b>
&nbsp;  }
&nbsp;
&nbsp;  private List&lt;String&gt; getStem(String word, int posStart, int posEnd) {
&nbsp;    // get prefix
&nbsp;    // extract only stem+suffix, the suffix ill be replaced by pronoun model
<b class="nc">&nbsp;    List&lt;String&gt; stemList = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;    String stem = word.substring(posStart);</b>
<b class="nc">&nbsp;    if (posEnd != word.length()) { // convert attached pronouns to one model form</b>
<b class="nc">&nbsp;      stem = stem.replaceAll(&quot;(ك|ها|هما|هم|هن|كما|كم|كن|نا|ي)$&quot;, &quot;ه&quot;);</b>
&nbsp;    }
&nbsp;    // correct some stems
&nbsp;    // correct case of للاسم
<b class="nc">&nbsp;    String prefix = getPrefix(word, posStart);</b>
<b class="nc">&nbsp;    if (prefix.endsWith(&quot;لل&quot;)) {</b>
<b class="nc">&nbsp;      stemList.add(&quot;ل&quot; + stem); // للاعب =&gt; لل- لاعب</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    stemList.add(stem);  // لاسم أو ل+لاعب</b>
<b class="nc">&nbsp;    return stemList;</b>
&nbsp;  }
&nbsp;
&nbsp;
&nbsp;  /*
&nbsp;   * a temporary attribute to be compatible with existing pronoun tag style
&nbsp;   */
&nbsp;  public void enableNewStylePronounTag() {
<b class="nc">&nbsp;    newStylePronounTag = true;</b>
&nbsp;  }
&nbsp;}
&nbsp;
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-02-20 19:41</div>
</div>
</body>
</html>
