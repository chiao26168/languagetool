


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > DocumentCursorTools</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.languagetool.openoffice</a>
</div>

<h1>Coverage Summary for Class: DocumentCursorTools (org.languagetool.openoffice)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">DocumentCursorTools</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/33)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/514)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/744)
  </span>
</td>
</tr>
  <tr>
    <td class="name">DocumentCursorTools$DocumentText</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">DocumentCursorTools$TextType</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/37)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/514)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/760)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/* LanguageTool, a natural language style checker
&nbsp; * Copyright (C) 2011 Daniel Naber (http://www.danielnaber.de)
&nbsp; *
&nbsp; * This library is free software; you can redistribute it and/or
&nbsp; * modify it under the terms of the GNU Lesser General Public
&nbsp; * License as published by the Free Software Foundation; either
&nbsp; * version 2.1 of the License, or (at your option) any later version.
&nbsp; *
&nbsp; * This library is distributed in the hope that it will be useful,
&nbsp; * but WITHOUT ANY WARRANTY; without even the implied warranty of
&nbsp; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
&nbsp; * Lesser General Public License for more details.
&nbsp; *
&nbsp; * You should have received a copy of the GNU Lesser General Public
&nbsp; * License along with this library; if not, write to the Free Software
&nbsp; * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301
&nbsp; * USA
&nbsp; */
&nbsp;package org.languagetool.openoffice;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;
&nbsp;import org.jetbrains.annotations.Nullable;
&nbsp;import org.languagetool.openoffice.DocumentCache.TextParagraph;
&nbsp;
&nbsp;import com.sun.star.beans.Property;
&nbsp;import com.sun.star.beans.XPropertySet;
&nbsp;import com.sun.star.container.XEnumeration;
&nbsp;import com.sun.star.container.XEnumerationAccess;
&nbsp;import com.sun.star.container.XIndexAccess;
&nbsp;import com.sun.star.container.XNameAccess;
&nbsp;import com.sun.star.container.XNameContainer;
&nbsp;import com.sun.star.drawing.XDrawPage;
&nbsp;import com.sun.star.drawing.XDrawPageSupplier;
&nbsp;import com.sun.star.drawing.XShape;
&nbsp;import com.sun.star.drawing.XShapes;
&nbsp;import com.sun.star.lang.XComponent;
&nbsp;import com.sun.star.style.XStyleFamiliesSupplier;
&nbsp;import com.sun.star.text.XFootnote;
&nbsp;import com.sun.star.text.XFootnotesSupplier;
&nbsp;import com.sun.star.text.XMarkingAccess;
&nbsp;import com.sun.star.text.TextMarkupType;
&nbsp;import com.sun.star.text.XEndnotesSupplier;
&nbsp;import com.sun.star.text.XParagraphCursor;
&nbsp;import com.sun.star.text.XText;
&nbsp;import com.sun.star.text.XTextCursor;
&nbsp;import com.sun.star.text.XTextDocument;
&nbsp;import com.sun.star.text.XTextRange;
&nbsp;import com.sun.star.text.XTextSection;
&nbsp;import com.sun.star.text.XTextTable;
&nbsp;import com.sun.star.text.XTextTablesSupplier;
&nbsp;import com.sun.star.uno.UnoRuntime;
&nbsp;
&nbsp;/**
&nbsp; * Information about Paragraphs of LibreOffice/OpenOffice documents
&nbsp; * on the basis of the LO/OO text cursor
&nbsp; * @since 4.0
&nbsp; * @author Fred Kruse
&nbsp; */
&nbsp;class DocumentCursorTools {
&nbsp;  
<b class="nc">&nbsp;  public static enum TextType {</b>
<b class="nc">&nbsp;    NORMAL,</b>
<b class="nc">&nbsp;    HEADING,</b>
<b class="nc">&nbsp;    AUTOMATIC</b>
&nbsp;  };
&nbsp;  
<b class="nc">&nbsp;  final static String HeaderFooterTypes[] = { &quot;HeaderText&quot;, </b>
&nbsp;      &quot;HeaderTextRight&quot;,
&nbsp;      &quot;HeaderTextLeft&quot;,
&nbsp;      &quot;HeaderTextFirst&quot;, 
&nbsp;      &quot;FooterText&quot;, 
&nbsp;      &quot;FooterTextRight&quot;, 
&nbsp;      &quot;FooterTextLeft&quot;,
&nbsp;      &quot;FooterTextFirst&quot; 
&nbsp;  };
&nbsp;
<b class="nc">&nbsp;  private static int isBusy = 0;</b>
&nbsp;  
<b class="nc">&nbsp;  private boolean isCheckedSortedTextId = false;</b>
<b class="nc">&nbsp;  private boolean hasSortedTextId = false;</b>
&nbsp;
&nbsp;  private XParagraphCursor xPCursor;
&nbsp;  private XTextCursor xTextCursor;
&nbsp;  private XTextDocument curDoc;
&nbsp;  
<b class="nc">&nbsp;  DocumentCursorTools(XComponent xComponent) {</b>
<b class="nc">&nbsp;    curDoc = UnoRuntime.queryInterface(XTextDocument.class, xComponent);</b>
<b class="nc">&nbsp;    xTextCursor = getCursor(xComponent);</b>
<b class="nc">&nbsp;    xPCursor = getParagraphCursor(xComponent);</b>
&nbsp;  }
&nbsp;  
&nbsp;  /**
&nbsp;   * document is disposed: set all class variables to null
&nbsp;   */
&nbsp;  public void setDisposed() {
<b class="nc">&nbsp;    xPCursor = null;</b>
<b class="nc">&nbsp;    xTextCursor = null;</b>
<b class="nc">&nbsp;    curDoc = null;</b>
&nbsp;  }
&nbsp;
&nbsp;  /** 
&nbsp;   * Returns the text cursor (if any)
&nbsp;   * Returns null if it fails
&nbsp;   */
&nbsp;  @Nullable
&nbsp;  private XTextCursor getCursor(XComponent xComponent) {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      if (curDoc == null) {</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;      }
<b class="nc">&nbsp;      XText xText = curDoc.getText();</b>
<b class="nc">&nbsp;      if (xText == null) {</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;      } else {
<b class="nc">&nbsp;        XTextRange xStart = xText.getStart();</b>
&nbsp;        try {
<b class="nc">&nbsp;          return xText.createTextCursorByRange(xStart);</b>
<b class="nc">&nbsp;        } catch (Throwable t) {</b>
<b class="nc">&nbsp;          return null;           // Return null without message - is needed for documents without main text (e.g. only a table)</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return null;           // Return null as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;
&nbsp;  /** 
&nbsp;   * Returns ParagraphCursor from TextCursor 
&nbsp;   * Returns null if it fails
&nbsp;   */
&nbsp;  @Nullable
&nbsp;  private XParagraphCursor getParagraphCursor(XComponent xComponent) {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      if (xTextCursor == null) {</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;      }
<b class="nc">&nbsp;      return UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return null;           // Return null as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns the TextCursor of the Document
&nbsp;   * Returns null if it fails
&nbsp;   */
&nbsp;  @Nullable
&nbsp;  public XTextCursor getTextCursor() {
<b class="nc">&nbsp;    return xTextCursor;</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns ParagraphCursor from TextCursor 
&nbsp;   * Returns null if it fails
&nbsp;   */
&nbsp;  @Nullable
&nbsp;  public XParagraphCursor getParagraphCursor() {
<b class="nc">&nbsp;    return xPCursor;</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns Number of all Text Paragraphs of Document without footnotes etc.  
&nbsp;   * Returns 0 if it fails
&nbsp;   */
&nbsp;  int getNumberOfAllTextParagraphs() {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      if (xPCursor == null) {</b>
<b class="nc">&nbsp;        return 0;</b>
&nbsp;      }
<b class="nc">&nbsp;      xPCursor.gotoStart(false);</b>
<b class="nc">&nbsp;      int nPara = 1;</b>
<b class="nc">&nbsp;      while (xPCursor.gotoNextParagraph(false)) nPara++;</b>
<b class="nc">&nbsp;      return nPara;</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return 0;              // Return 0 as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Give back a list of positions of deleted characters 
&nbsp;   * or null if there are no
&nbsp;   */
&nbsp;  private static List&lt;Integer&gt; getDeletedCharacters(XParagraphCursor xPCursor) {
<b class="nc">&nbsp;    if (xPCursor == null) {</b>
<b class="nc">&nbsp;      MessageHandler.printToLogFile(&quot;DocumentCursorTools: Properties: ParagraphCursor == null&quot;);</b>
<b class="nc">&nbsp;      return null;</b>
&nbsp;    }
<b class="nc">&nbsp;    List&lt;Integer&gt; deletePositions = new ArrayList&lt;Integer&gt;();</b>
<b class="nc">&nbsp;    int num = 0;</b>
&nbsp;    try {
<b class="nc">&nbsp;      XEnumerationAccess xParaEnumAccess = UnoRuntime.queryInterface(XEnumerationAccess.class, xPCursor);</b>
<b class="nc">&nbsp;      if (xParaEnumAccess == null) {</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;      }
<b class="nc">&nbsp;      XEnumeration xParaEnum = xParaEnumAccess.createEnumeration();</b>
<b class="nc">&nbsp;      if (xParaEnum == null) {</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;      }
<b class="nc">&nbsp;      while (xParaEnum.hasMoreElements()) {</b>
<b class="nc">&nbsp;        XEnumerationAccess xEnumAccess = UnoRuntime.queryInterface(XEnumerationAccess.class, xParaEnum.nextElement());</b>
<b class="nc">&nbsp;        if (xEnumAccess == null) {</b>
<b class="nc">&nbsp;          continue;</b>
&nbsp;        }
<b class="nc">&nbsp;        XEnumeration xEnum = xEnumAccess.createEnumeration();</b>
<b class="nc">&nbsp;        if (xEnum == null) {</b>
<b class="nc">&nbsp;          continue;</b>
&nbsp;        }
<b class="nc">&nbsp;        boolean isDelete = false;</b>
<b class="nc">&nbsp;        while (xEnum.hasMoreElements()) {</b>
<b class="nc">&nbsp;          XTextRange xPortion = (XTextRange) UnoRuntime.queryInterface(XTextRange.class, xEnum.nextElement());</b>
<b class="nc">&nbsp;          if (xPortion == null) {</b>
<b class="nc">&nbsp;            continue;</b>
&nbsp;          }
<b class="nc">&nbsp;          XPropertySet xTextPortionPropertySet = UnoRuntime.queryInterface(XPropertySet.class, xPortion);</b>
<b class="nc">&nbsp;          if (xTextPortionPropertySet == null) {</b>
<b class="nc">&nbsp;            continue;</b>
&nbsp;          }
<b class="nc">&nbsp;          String textPortionType = (String) xTextPortionPropertySet.getPropertyValue(&quot;TextPortionType&quot;);</b>
<b class="nc">&nbsp;          if (textPortionType != null &amp;&amp; textPortionType.equals(&quot;Redline&quot;)) {</b>
<b class="nc">&nbsp;            String redlineType = (String) xTextPortionPropertySet.getPropertyValue(&quot;RedlineType&quot;);</b>
<b class="nc">&nbsp;            if (redlineType != null &amp;&amp; redlineType.equals(&quot;Delete&quot;)) {</b>
<b class="nc">&nbsp;              isDelete = !isDelete;</b>
&nbsp;            }
<b class="nc">&nbsp;          } else {</b>
<b class="nc">&nbsp;            int portionLen = xPortion.getString().length();</b>
<b class="nc">&nbsp;            if (isDelete) {</b>
<b class="nc">&nbsp;              for (int i = num; i &lt; num + portionLen; i++) {</b>
<b class="nc">&nbsp;                deletePositions.add(i);</b>
&nbsp;              }
&nbsp;            }
<b class="nc">&nbsp;            num += portionLen;</b>
&nbsp;          }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;      }</b>
<b class="nc">&nbsp;    } catch (Throwable e) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(e);</b>
<b class="nc">&nbsp;    }</b>
<b class="nc">&nbsp;    if (deletePositions.isEmpty()) {</b>
<b class="nc">&nbsp;      return null;</b>
&nbsp;    }
<b class="nc">&nbsp;    return deletePositions;</b>
&nbsp;  }
&nbsp;
&nbsp;  /** 
&nbsp;   * Returns all Paragraphs of Document without footnotes etc.  
&nbsp;   * Returns null if it fails
&nbsp;   */
&nbsp;  @Nullable
&nbsp;  DocumentText getAllTextParagraphs() {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      List&lt;String&gt; allParas = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;      List&lt;Integer&gt; headingNumbers = new ArrayList&lt;Integer&gt;();</b>
<b class="nc">&nbsp;      List&lt;Integer&gt; automaticTextParagraphs = new ArrayList&lt;Integer&gt;();</b>
<b class="nc">&nbsp;      List&lt;Integer&gt; sortedTextIds = null;</b>
<b class="nc">&nbsp;      List&lt;List&lt;Integer&gt;&gt; deletedCharacters = new ArrayList&lt;List&lt;Integer&gt;&gt;();</b>
<b class="nc">&nbsp;      if (xPCursor == null) {</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;      }
<b class="nc">&nbsp;      int paraNum = 0;</b>
<b class="nc">&nbsp;      xPCursor.gotoStart(false);</b>
<b class="nc">&nbsp;      xPCursor.gotoStartOfParagraph(false);</b>
<b class="nc">&nbsp;      xPCursor.gotoEndOfParagraph(true);</b>
<b class="nc">&nbsp;      if (sortedTextIds == null &amp;&amp; (hasSortedTextId || !isCheckedSortedTextId)) {</b>
<b class="nc">&nbsp;        isCheckedSortedTextId = true;</b>
<b class="nc">&nbsp;        if (hasSortedTextId || supportOfSortedTextId(xPCursor)) {</b>
<b class="nc">&nbsp;          hasSortedTextId = true;</b>
<b class="nc">&nbsp;          sortedTextIds = new ArrayList&lt;Integer&gt;();</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      allParas.add(xPCursor.getString());</b>
&nbsp;//      MessageHandler.printToLogFile(&quot;DocumentCursor: getAllTextParagraphs: Para(&quot; + paraNum + &quot;) added&quot;);
<b class="nc">&nbsp;      deletedCharacters.add(getDeletedCharacters(xPCursor));</b>
<b class="nc">&nbsp;      TextType textType = getTextType();</b>
<b class="nc">&nbsp;      if (textType == TextType.HEADING) {</b>
<b class="nc">&nbsp;        headingNumbers.add(paraNum);</b>
<b class="nc">&nbsp;      } else if (textType == TextType.AUTOMATIC) {</b>
<b class="nc">&nbsp;        headingNumbers.add(paraNum);</b>
<b class="nc">&nbsp;        automaticTextParagraphs.add(paraNum);</b>
&nbsp;      }
<b class="nc">&nbsp;      if (sortedTextIds != null) {</b>
<b class="nc">&nbsp;        sortedTextIds.add(getSortedTextId(xPCursor));</b>
&nbsp;      }
<b class="nc">&nbsp;      while (xPCursor.gotoNextParagraph(false)) {</b>
<b class="nc">&nbsp;        xPCursor.gotoStartOfParagraph(false);</b>
<b class="nc">&nbsp;        xPCursor.gotoEndOfParagraph(true);</b>
<b class="nc">&nbsp;        allParas.add(xPCursor.getString());</b>
&nbsp;//        MessageHandler.printToLogFile(&quot;DocumentCursor: getAllTextParagraphs: Para(&quot; + (paraNum + 1) + &quot;) added&quot;);
<b class="nc">&nbsp;        deletedCharacters.add(getDeletedCharacters(xPCursor));</b>
&nbsp;//        MessageHandler.printToLogFile(&quot;DocumentCursor: getAllTextParagraphs: deletedCharacters(&quot; + (paraNum + 1) + &quot;) added&quot;);
<b class="nc">&nbsp;        paraNum++;</b>
<b class="nc">&nbsp;        textType = getTextType();</b>
<b class="nc">&nbsp;        if (textType == TextType.HEADING) {</b>
<b class="nc">&nbsp;          headingNumbers.add(paraNum);</b>
<b class="nc">&nbsp;        } else if (textType == TextType.AUTOMATIC) {</b>
<b class="nc">&nbsp;          headingNumbers.add(paraNum);</b>
<b class="nc">&nbsp;          automaticTextParagraphs.add(paraNum);</b>
&nbsp;        } 
<b class="nc">&nbsp;        if (sortedTextIds != null) {</b>
<b class="nc">&nbsp;          sortedTextIds.add(getSortedTextId(xPCursor));</b>
&nbsp;        }
&nbsp;//        MessageHandler.printToLogFile(&quot;DocumentCursor: getAllTextParagraphs: headingNumbers(&quot; + (paraNum) + &quot;) added&quot;);
&nbsp;      }
<b class="nc">&nbsp;      return new DocumentText(allParas, headingNumbers, automaticTextParagraphs, sortedTextIds, deletedCharacters);</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return null;           // Return null as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Paragraph is Header or Title
&nbsp;   */
&nbsp;  private TextType getTextType() {
<b class="nc">&nbsp;    String paraStyleName = null;</b>
<b class="nc">&nbsp;    XPropertySet xParagraphPropertySet = null;</b>
&nbsp;    try {
<b class="nc">&nbsp;      xParagraphPropertySet = UnoRuntime.queryInterface(XPropertySet.class, xPCursor.getStart());</b>
<b class="nc">&nbsp;      if (xParagraphPropertySet == null) {</b>
<b class="nc">&nbsp;        return TextType.NORMAL;</b>
&nbsp;      }
<b class="nc">&nbsp;      Object o = xParagraphPropertySet.getPropertyValue(&quot;ParaStyleName&quot;);</b>
<b class="nc">&nbsp;      if (o != null) {</b>
<b class="nc">&nbsp;        paraStyleName = (String) o;</b>
&nbsp;      }
<b class="nc">&nbsp;    } catch (Throwable e) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(e);</b>
<b class="nc">&nbsp;      return TextType.NORMAL;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;    try {
<b class="nc">&nbsp;      XTextSection xTextSection = UnoRuntime.queryInterface(XTextSection.class, xParagraphPropertySet.getPropertyValue(&quot;TextSection&quot;));</b>
<b class="nc">&nbsp;      if (xParagraphPropertySet != null) {</b>
<b class="nc">&nbsp;        xParagraphPropertySet = UnoRuntime.queryInterface(XPropertySet.class, xTextSection);</b>
<b class="nc">&nbsp;        Object o = xParagraphPropertySet.getPropertyValue(&quot;IsProtected&quot;);</b>
<b class="nc">&nbsp;        if (o != null &amp;&amp; (boolean) o) {</b>
<b class="nc">&nbsp;          return TextType.AUTOMATIC;</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;    } catch (Throwable e) {</b>
&nbsp;      //  if there is an exception go on with analysis - TextType is not automatic
<b class="nc">&nbsp;    }</b>
<b class="nc">&nbsp;    if (paraStyleName != null &amp;&amp; (paraStyleName.startsWith(&quot;Heading&quot;) || paraStyleName.equals(&quot;Title&quot;) || paraStyleName.equals(&quot;Subtitle&quot;))) {</b>
<b class="nc">&nbsp;      return TextType.HEADING;</b>
&nbsp;    }
<b class="nc">&nbsp;    else if (paraStyleName != null &amp;&amp; paraStyleName.startsWith(&quot;Contents&quot;)) {</b>
<b class="nc">&nbsp;      return TextType.AUTOMATIC;</b>
&nbsp;    } else {
<b class="nc">&nbsp;      return TextType.NORMAL;</b>
&nbsp;    }
&nbsp;  }
&nbsp;  
&nbsp;  /**
&nbsp;   * Print properties to log file for the actual position of cursor
&nbsp;   */
&nbsp;  private void printProperties() {
<b class="nc">&nbsp;    if (xPCursor == null) {</b>
<b class="nc">&nbsp;      MessageHandler.printToLogFile(&quot;DocumentCursorTools: Properties: ParagraphCursor == null&quot;);</b>
&nbsp;      return;
&nbsp;    }
<b class="nc">&nbsp;    XPropertySet xParagraphPropertySet = UnoRuntime.queryInterface(XPropertySet.class, xPCursor.getStart());</b>
<b class="nc">&nbsp;    Property[] properties = xParagraphPropertySet.getPropertySetInfo().getProperties();</b>
<b class="nc">&nbsp;    for (Property property : properties) {</b>
<b class="nc">&nbsp;      MessageHandler.printToLogFile(&quot;DocumentCursorTools: Properties: Name: &quot; + property.Name + &quot;, Type: &quot; + property.Type);</b>
&nbsp;    }
&nbsp;    try {
&nbsp;//      MessageHandler.printToLogFile(&quot;DocumentCursorTools: Properties: ParaStyleName: &quot; + xParagraphPropertySet.getPropertyValue(&quot;ParaStyleName&quot;));
<b class="nc">&nbsp;      MessageHandler.printToLogFile(&quot;DocumentCursorTools: Properties: SortedTextId: &quot; + xParagraphPropertySet.getPropertyValue(&quot;SortedTextId&quot;) + &quot;\n&quot;);</b>
<b class="nc">&nbsp;    } catch (Throwable e) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(e);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /**
&nbsp;   * Print properties to log file for the actual position of cursor
&nbsp;   */
&nbsp;  private static int getSortedTextId(XParagraphCursor xPCursor) {
&nbsp;    try {
<b class="nc">&nbsp;      if (xPCursor == null) {</b>
<b class="nc">&nbsp;        MessageHandler.printToLogFile(&quot;DocumentCursorTools: Properties: ParagraphCursor == null&quot;);</b>
<b class="nc">&nbsp;        return -1;</b>
&nbsp;      }
<b class="nc">&nbsp;      XPropertySet xParagraphPropertySet = UnoRuntime.queryInterface(XPropertySet.class, xPCursor.getStart());</b>
<b class="nc">&nbsp;      return (int) xParagraphPropertySet.getPropertyValue(&quot;SortedTextId&quot;);</b>
<b class="nc">&nbsp;    } catch (Throwable e) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(e);</b>
&nbsp;    }
<b class="nc">&nbsp;    return -1;</b>
&nbsp;  }
&nbsp;  
&nbsp;  /**
&nbsp;   * Print properties to log file for the actual position of cursor
&nbsp;   */
&nbsp;  private boolean supportOfSortedTextId(XParagraphCursor xPCursor) {
&nbsp;    try {
<b class="nc">&nbsp;      if (xPCursor == null) {</b>
<b class="nc">&nbsp;        MessageHandler.printToLogFile(&quot;DocumentCursorTools: Properties: ParagraphCursor == null&quot;);</b>
<b class="nc">&nbsp;        return false;</b>
&nbsp;      }
<b class="nc">&nbsp;      XPropertySet xParagraphPropertySet = UnoRuntime.queryInterface(XPropertySet.class, xPCursor.getStart());</b>
<b class="nc">&nbsp;      return xParagraphPropertySet.getPropertyValue(&quot;SortedTextId&quot;) != null;</b>
<b class="nc">&nbsp;    } catch (Throwable e) {</b>
&nbsp;//      MessageHandler.printException(e);
&nbsp;    }
<b class="nc">&nbsp;    return false;</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Add all paragraphs of XText to a list of strings
&nbsp;   */
&nbsp;  private List&lt;Integer&gt; addAllParagraphsOfText(XText xText, List&lt;String&gt; sText, List&lt;List&lt;Integer&gt;&gt; deletedCharacters, List&lt;Integer&gt; sortedTextIds) {
<b class="nc">&nbsp;    XTextCursor xTextCursor = xText.createTextCursor();</b>
<b class="nc">&nbsp;    XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;    if (xParagraphCursor == null) {</b>
<b class="nc">&nbsp;      return sortedTextIds;</b>
&nbsp;    }
&nbsp;    try {
&nbsp;      try {
<b class="nc">&nbsp;        if (sortedTextIds == null &amp;&amp; (hasSortedTextId || !isCheckedSortedTextId)) {</b>
<b class="nc">&nbsp;          isCheckedSortedTextId = true;</b>
<b class="nc">&nbsp;          if (hasSortedTextId || supportOfSortedTextId(xParagraphCursor)) {</b>
<b class="nc">&nbsp;            hasSortedTextId = true;</b>
<b class="nc">&nbsp;            sortedTextIds = new ArrayList&lt;Integer&gt;();</b>
&nbsp;          }
&nbsp;        }
<b class="nc">&nbsp;      } catch (Exception e) {</b>
&nbsp;        // TODO Automatisch generierter Erfassungsblock
<b class="nc">&nbsp;        e.printStackTrace();</b>
<b class="nc">&nbsp;      }</b>
<b class="nc">&nbsp;    } catch (Exception e) {</b>
&nbsp;      // TODO Automatisch generierter Erfassungsblock
<b class="nc">&nbsp;      e.printStackTrace();</b>
<b class="nc">&nbsp;    }</b>
<b class="nc">&nbsp;    xParagraphCursor.gotoStart(false);</b>
&nbsp;    do {
<b class="nc">&nbsp;      xParagraphCursor.gotoStartOfParagraph(false);</b>
<b class="nc">&nbsp;      xParagraphCursor.gotoEndOfParagraph(true);</b>
<b class="nc">&nbsp;      sText.add(xParagraphCursor.getString());</b>
<b class="nc">&nbsp;      deletedCharacters.add(getDeletedCharacters(xParagraphCursor));</b>
<b class="nc">&nbsp;      if (sortedTextIds != null) {</b>
<b class="nc">&nbsp;        sortedTextIds.add(getSortedTextId(xParagraphCursor));</b>
&nbsp;      }
<b class="nc">&nbsp;    } while (xParagraphCursor.gotoNextParagraph(false));</b>
<b class="nc">&nbsp;    return sortedTextIds;</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Get the number of all paragraphs of XText
&nbsp;   */
&nbsp;  private static int getNumberOfAllParagraphsOfText(XText xText) {
<b class="nc">&nbsp;    int num = 0;</b>
<b class="nc">&nbsp;    XTextCursor xTextCursor = xText.createTextCursor();</b>
<b class="nc">&nbsp;    XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;    xParagraphCursor.gotoStart(false);</b>
&nbsp;    do {
<b class="nc">&nbsp;      num++;</b>
<b class="nc">&nbsp;    } while (xParagraphCursor.gotoNextParagraph(false));</b>
<b class="nc">&nbsp;    return num;</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns all paragraphs of all text frames of a document
&nbsp;   */
&nbsp;/*        Commented out because shapes seams the more general concept to be      
&nbsp;  public DocumentText getTextOfAllFrames() {
&nbsp;    isBusy++;
&nbsp;    try {
&nbsp;      List&lt;String&gt; sText = new ArrayList&lt;String&gt;();
&nbsp;      List&lt;Integer&gt; headingNumbers = new ArrayList&lt;Integer&gt;();
&nbsp;      List&lt;List&lt;Integer&gt;&gt; deletedCharacters = new ArrayList&lt;List&lt;Integer&gt;&gt;();
&nbsp;      XTextFramesSupplier xTextFrameSupplier = UnoRuntime.queryInterface(XTextFramesSupplier.class, curDoc);
&nbsp;      XNameAccess xNamedFrames = xTextFrameSupplier.getTextFrames();
&nbsp;      for (String name : xNamedFrames.getElementNames()) {
&nbsp;        List&lt;String&gt; sTxt = new ArrayList&lt;String&gt;();
&nbsp;        List&lt;List&lt;Integer&gt;&gt; delCharacters = new ArrayList&lt;List&lt;Integer&gt;&gt;();
&nbsp;        Object o = xNamedFrames.getByName(name);
&nbsp;        XText xFrameText = UnoRuntime.queryInterface(XText.class,  o);
&nbsp;        addAllParagraphsOfText(xFrameText, sTxt, delCharacters);
&nbsp;        for (int i = 0; i &lt; headingNumbers.size(); i++) {
&nbsp;          headingNumbers.set(i, headingNumbers.get(i) + sTxt.size());
&nbsp;        }
&nbsp;        headingNumbers.add(0, 0);
&nbsp;        sText.addAll(0, sTxt);
&nbsp;        deletedCharacters.addAll(0, delCharacters);
&nbsp;      }
&nbsp;      return new DocumentText(sText, headingNumbers, new ArrayList&lt;Integer&gt;(), deletedCharacters);
&nbsp;    } catch (Throwable t) {
&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file
&nbsp;      return null;           // Return null as method failed
&nbsp;    } finally {
&nbsp;      isBusy--;
&nbsp;    }
&nbsp;  }
&nbsp;*/  
&nbsp;  /** 
&nbsp;   * Returns the number of all paragraphs of all text frames of a document
&nbsp;   */
&nbsp;/*        Commented out because shapes seams the more general concept to be      
&nbsp;  public int getNumberOfAllFrames() {
&nbsp;    isBusy++;
&nbsp;    try {
&nbsp;      int num = 0;
&nbsp;      if (curDoc != null) {
&nbsp;        XTextFramesSupplier xTextFrameSupplier = UnoRuntime.queryInterface(XTextFramesSupplier.class, curDoc);
&nbsp;        XNameAccess xNamedFrames = xTextFrameSupplier.getTextFrames();
&nbsp;        for (String name : xNamedFrames.getElementNames()) {
&nbsp;          Object o = xNamedFrames.getByName(name);
&nbsp;          XText xFrameText = UnoRuntime.queryInterface(XText.class,  o);
&nbsp;          num += getNumberOfAllParagraphsOfText(xFrameText);
&nbsp;        }
&nbsp;      }
&nbsp;      return num;
&nbsp;    } catch (Throwable t) {
&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file
&nbsp;      return 0;           // Return 0 as method failed
&nbsp;    } finally {
&nbsp;      isBusy--;
&nbsp;    }
&nbsp;  }
&nbsp;*/  
&nbsp;  /** 
&nbsp;   * Returns all paragraphs of all text shapes of a document
&nbsp;   */
&nbsp;  public DocumentText getTextOfAllShapes() {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      List&lt;String&gt; sText = new ArrayList&lt;String&gt;();</b>
<b class="nc">&nbsp;      List&lt;Integer&gt; headingNumbers = new ArrayList&lt;Integer&gt;();</b>
<b class="nc">&nbsp;      List&lt;Integer&gt; sortedTextIds = null;</b>
<b class="nc">&nbsp;      List&lt;List&lt;Integer&gt;&gt; deletedCharacters = new ArrayList&lt;List&lt;Integer&gt;&gt;();</b>
<b class="nc">&nbsp;      XDrawPageSupplier xDrawPageSupplier = UnoRuntime.queryInterface(XDrawPageSupplier.class, curDoc);</b>
<b class="nc">&nbsp;      if (xDrawPageSupplier == null) {</b>
<b class="nc">&nbsp;        MessageHandler.printToLogFile(&quot;XDrawPageSupplier == null&quot;);</b>
<b class="nc">&nbsp;        return new DocumentText(sText, headingNumbers, new ArrayList&lt;Integer&gt;(), sortedTextIds, deletedCharacters);</b>
&nbsp;      }
<b class="nc">&nbsp;      XDrawPage xDrawPage = xDrawPageSupplier.getDrawPage();</b>
<b class="nc">&nbsp;      if (xDrawPage == null) {</b>
<b class="nc">&nbsp;        MessageHandler.printToLogFile(&quot;XDrawPage == null&quot;);</b>
<b class="nc">&nbsp;        return new DocumentText(sText, headingNumbers, new ArrayList&lt;Integer&gt;(), sortedTextIds, deletedCharacters);</b>
&nbsp;      }
<b class="nc">&nbsp;      XShapes xShapes = UnoRuntime.queryInterface(XShapes.class, xDrawPage);</b>
<b class="nc">&nbsp;      int nShapes = xShapes.getCount();</b>
<b class="nc">&nbsp;      for(int j = 0; j &lt; nShapes; j++) {</b>
<b class="nc">&nbsp;        Object oShape = xShapes.getByIndex(j);</b>
<b class="nc">&nbsp;        XShape xShape = UnoRuntime.queryInterface(XShape.class, oShape);</b>
<b class="nc">&nbsp;        if (xShape != null) {</b>
<b class="nc">&nbsp;          XText xShapeText = UnoRuntime.queryInterface(XText.class, xShape);</b>
<b class="nc">&nbsp;          if (xShapeText != null) {</b>
<b class="nc">&nbsp;            sortedTextIds = addAllParagraphsOfText(xShapeText, sText, deletedCharacters, sortedTextIds);</b>
<b class="nc">&nbsp;            headingNumbers.add(sText.size());</b>
&nbsp;          }
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      return new DocumentText(sText, headingNumbers, new ArrayList&lt;Integer&gt;(), sortedTextIds, deletedCharacters);</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return null;           // Return null as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns the number of all paragraphs of all text shapes of a document
&nbsp;   */
&nbsp;  public int getNumberOfAllShapes() {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      int num = 0;</b>
<b class="nc">&nbsp;      if (curDoc != null) {</b>
<b class="nc">&nbsp;        XDrawPageSupplier xDrawPageSupplier = UnoRuntime.queryInterface(XDrawPageSupplier.class, curDoc);</b>
<b class="nc">&nbsp;        if (xDrawPageSupplier == null) {</b>
<b class="nc">&nbsp;          MessageHandler.printToLogFile(&quot;XDrawPageSupplier == null&quot;);</b>
<b class="nc">&nbsp;          return 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        XDrawPage xDrawPage = xDrawPageSupplier.getDrawPage();</b>
<b class="nc">&nbsp;        if (xDrawPage == null) {</b>
<b class="nc">&nbsp;          MessageHandler.printToLogFile(&quot;XDrawPage == null&quot;);</b>
<b class="nc">&nbsp;          return 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        XShapes xShapes = UnoRuntime.queryInterface(XShapes.class, xDrawPage);</b>
<b class="nc">&nbsp;        int nShapes = xShapes.getCount();</b>
<b class="nc">&nbsp;        for(int j = 0; j &lt; nShapes; j++) {</b>
<b class="nc">&nbsp;          Object oShape = xShapes.getByIndex(j);</b>
<b class="nc">&nbsp;          XShape xShape = UnoRuntime.queryInterface(XShape.class, oShape);</b>
<b class="nc">&nbsp;          if (xShape != null) {</b>
<b class="nc">&nbsp;            XText xShapeText = UnoRuntime.queryInterface(XText.class, xShape);</b>
<b class="nc">&nbsp;            if (xShapeText != null) {</b>
<b class="nc">&nbsp;              num += getNumberOfAllParagraphsOfText(xShapeText);</b>
&nbsp;            }
&nbsp;          }
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      return num;</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return 0;           // Return 0 as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns the Index Access to all tables of a document
&nbsp;   */
&nbsp;  private XIndexAccess getIndexAccessOfAllTables() {
&nbsp;    try {
<b class="nc">&nbsp;      if (curDoc == null) {</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;      }
&nbsp;      // Get the TextTablesSupplier interface of the document
<b class="nc">&nbsp;      XTextTablesSupplier xTableSupplier = UnoRuntime.queryInterface(XTextTablesSupplier.class, curDoc);</b>
&nbsp;      // Get an XIndexAccess of TextTables
<b class="nc">&nbsp;      return UnoRuntime.queryInterface(XIndexAccess.class, xTableSupplier.getTextTables());</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return null;           // Return null as method failed</b>
&nbsp;    }
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns all paragraphs of all cells of all tables of a document
&nbsp;   */
&nbsp;  public DocumentText getTextOfAllTables() {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      List&lt;String&gt; sText = new ArrayList&lt;String&gt;();</b>
<b class="nc">&nbsp;      List&lt;Integer&gt; headingNumbers = new ArrayList&lt;Integer&gt;();</b>
<b class="nc">&nbsp;      List&lt;Integer&gt; sortedTextIds = null;</b>
<b class="nc">&nbsp;      XIndexAccess xTables = getIndexAccessOfAllTables();</b>
<b class="nc">&nbsp;      List&lt;List&lt;Integer&gt;&gt; deletedCharacters = new ArrayList&lt;List&lt;Integer&gt;&gt;();</b>
<b class="nc">&nbsp;      if (xTables != null) {</b>
&nbsp;        // Get all Tables of Document
<b class="nc">&nbsp;        for (int i = 0; i &lt; xTables.getCount(); i++) {</b>
<b class="nc">&nbsp;          XTextTable xTable = UnoRuntime.queryInterface(XTextTable.class, xTables.getByIndex(i));</b>
&nbsp;          // Get all Cells of Tables
<b class="nc">&nbsp;          for (String cellName : xTable.getCellNames()) {</b>
<b class="nc">&nbsp;            XText xTableText = UnoRuntime.queryInterface(XText.class, xTable.getCellByName(cellName) );</b>
<b class="nc">&nbsp;            headingNumbers.add(sText.size());</b>
<b class="nc">&nbsp;            sortedTextIds = addAllParagraphsOfText(xTableText, sText, deletedCharacters, sortedTextIds);</b>
&nbsp;          }
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      return new DocumentText(sText, headingNumbers, new ArrayList&lt;Integer&gt;(), sortedTextIds, deletedCharacters);</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return null;           // Return null as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns the number of paragraphs of all cells of all tables of a document
&nbsp;   */
&nbsp;  public int getNumberOfAllTables() {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      int num = 0;</b>
<b class="nc">&nbsp;      XIndexAccess xTables = getIndexAccessOfAllTables();</b>
<b class="nc">&nbsp;      if (xTables != null) {</b>
&nbsp;        // Get all Tables of Document
<b class="nc">&nbsp;        for (int i = 0; i &lt; xTables.getCount(); i++) {</b>
<b class="nc">&nbsp;          XTextTable xTable = UnoRuntime.queryInterface(XTextTable.class, xTables.getByIndex(i));</b>
&nbsp;          // Get all Cells of Tables
<b class="nc">&nbsp;          for (String cellName : xTable.getCellNames()) {</b>
<b class="nc">&nbsp;            XText xTableText = UnoRuntime.queryInterface(XText.class, xTable.getCellByName(cellName) );</b>
<b class="nc">&nbsp;            num += getNumberOfAllParagraphsOfText(xTableText);</b>
&nbsp;          }
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      return num;</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return 0;           // Return 0 as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns all paragraphs of all footnotes of a document
&nbsp;   */
&nbsp;  public DocumentText getTextOfAllFootnotes() {
<b class="nc">&nbsp;    List&lt;String&gt; sText = new ArrayList&lt;String&gt;();</b>
<b class="nc">&nbsp;    List&lt;Integer&gt; headingNumbers = new ArrayList&lt;Integer&gt;();</b>
<b class="nc">&nbsp;    List&lt;Integer&gt; sortedTextIds = null;</b>
<b class="nc">&nbsp;    List&lt;List&lt;Integer&gt;&gt; deletedCharacters = new ArrayList&lt;List&lt;Integer&gt;&gt;();</b>
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      if (curDoc != null) {</b>
&nbsp;        // Get the XFootnotesSupplier interface of the document
<b class="nc">&nbsp;        XFootnotesSupplier xFootnoteSupplier = UnoRuntime.queryInterface(XFootnotesSupplier.class, curDoc );</b>
&nbsp;        // Get an XIndexAccess of Footnotes
<b class="nc">&nbsp;        XIndexAccess xFootnotes = UnoRuntime.queryInterface(XIndexAccess.class, xFootnoteSupplier.getFootnotes());</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; xFootnotes.getCount(); i++) {</b>
<b class="nc">&nbsp;          XFootnote xFootnote = UnoRuntime.queryInterface(XFootnote.class, xFootnotes.getByIndex(i));</b>
<b class="nc">&nbsp;          XText xFootnoteText = UnoRuntime.queryInterface(XText.class, xFootnote);</b>
<b class="nc">&nbsp;          headingNumbers.add(sText.size());</b>
<b class="nc">&nbsp;          sortedTextIds = addAllParagraphsOfText(xFootnoteText, sText, deletedCharacters, sortedTextIds);</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      return new DocumentText(sText, headingNumbers, new ArrayList&lt;Integer&gt;(), sortedTextIds, deletedCharacters);</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return null;           // Return null as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns the number of paragraphs of all footnotes of a document
&nbsp;   */
&nbsp;  public int getNumberOfAllFootnotes() {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      int num = 0;</b>
<b class="nc">&nbsp;      if (curDoc != null) {</b>
&nbsp;        // Get the XFootnotesSupplier interface of the document
<b class="nc">&nbsp;        XFootnotesSupplier xFootnoteSupplier = UnoRuntime.queryInterface(XFootnotesSupplier.class, curDoc );</b>
&nbsp;        // Get an XIndexAccess of Footnotes
<b class="nc">&nbsp;        XIndexAccess xFootnotes = UnoRuntime.queryInterface(XIndexAccess.class, xFootnoteSupplier.getFootnotes());</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; xFootnotes.getCount(); i++) {</b>
<b class="nc">&nbsp;          XFootnote xFootnote = UnoRuntime.queryInterface(XFootnote.class, xFootnotes.getByIndex(i));</b>
<b class="nc">&nbsp;          XText xFootnoteText = UnoRuntime.queryInterface(XText.class, xFootnote);</b>
<b class="nc">&nbsp;          num += getNumberOfAllParagraphsOfText(xFootnoteText);</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      return num;</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return 0;           // Return 0 as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns all paragraphs of all endnotes of a document
&nbsp;   */
&nbsp;  public DocumentText getTextOfAllEndnotes() {
<b class="nc">&nbsp;    List&lt;String&gt; sText = new ArrayList&lt;String&gt;();</b>
<b class="nc">&nbsp;    List&lt;Integer&gt; headingNumbers = new ArrayList&lt;Integer&gt;();</b>
<b class="nc">&nbsp;    List&lt;Integer&gt; sortedTextIds = null;</b>
<b class="nc">&nbsp;    List&lt;List&lt;Integer&gt;&gt; deletedCharacters = new ArrayList&lt;List&lt;Integer&gt;&gt;();</b>
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      if (curDoc != null) {</b>
&nbsp;        // Get the XEndnotesSupplier interface of the document
<b class="nc">&nbsp;        XEndnotesSupplier xEndnoteSupplier = UnoRuntime.queryInterface(XEndnotesSupplier.class, curDoc );</b>
&nbsp;        // Get an XIndexAccess of Endnotes
<b class="nc">&nbsp;        XIndexAccess xEndnotes = UnoRuntime.queryInterface(XIndexAccess.class, xEndnoteSupplier.getEndnotes());</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; xEndnotes.getCount(); i++) {</b>
<b class="nc">&nbsp;          XFootnote xEndnote = UnoRuntime.queryInterface(XFootnote.class, xEndnotes.getByIndex(i));</b>
<b class="nc">&nbsp;          XText xFootnoteText = UnoRuntime.queryInterface(XText.class, xEndnote);</b>
<b class="nc">&nbsp;          headingNumbers.add(sText.size());</b>
<b class="nc">&nbsp;          sortedTextIds = addAllParagraphsOfText(xFootnoteText, sText, deletedCharacters, sortedTextIds);</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      return new DocumentText(sText, headingNumbers, new ArrayList&lt;Integer&gt;(), sortedTextIds, deletedCharacters);</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return null;           // Return null as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns number of paragraphs of all endnotes of a document
&nbsp;   */
&nbsp;  public int getNumberOfAllEndnotes() {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      int num = 0;</b>
<b class="nc">&nbsp;      if (curDoc != null) {</b>
&nbsp;        // Get the XEndnotesSupplier interface of the document
<b class="nc">&nbsp;        XEndnotesSupplier xEndnoteSupplier = UnoRuntime.queryInterface(XEndnotesSupplier.class, curDoc );</b>
&nbsp;        // Get an XIndexAccess of Endnotes
<b class="nc">&nbsp;        XIndexAccess xEndnotes = UnoRuntime.queryInterface(XIndexAccess.class, xEndnoteSupplier.getEndnotes());</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; xEndnotes.getCount(); i++) {</b>
<b class="nc">&nbsp;          XFootnote xEndnote = UnoRuntime.queryInterface(XFootnote.class, xEndnotes.getByIndex(i));</b>
<b class="nc">&nbsp;          XText xFootnoteText = UnoRuntime.queryInterface(XText.class, xEndnote);</b>
<b class="nc">&nbsp;          num += getNumberOfAllParagraphsOfText(xFootnoteText);</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      return num;</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return 0;           // Return 0 as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns the page property sets of of a document
&nbsp;   */
&nbsp;  private List&lt;XPropertySet&gt; getPagePropertySets() {
&nbsp;    try {
<b class="nc">&nbsp;      List&lt;XPropertySet&gt; propertySets = new ArrayList&lt;XPropertySet&gt;();</b>
<b class="nc">&nbsp;      if (curDoc == null) {</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;      }
<b class="nc">&nbsp;      XStyleFamiliesSupplier xSupplier =  UnoRuntime.queryInterface(XStyleFamiliesSupplier.class, curDoc);</b>
<b class="nc">&nbsp;      XNameAccess xNameAccess = xSupplier.getStyleFamilies();</b>
<b class="nc">&nbsp;      if (xNameAccess == null) {</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;      }
<b class="nc">&nbsp;      XNameContainer pageStyleCon = UnoRuntime.queryInterface(XNameContainer.class, xNameAccess.getByName(&quot;PageStyles&quot;));</b>
<b class="nc">&nbsp;      if (pageStyleCon == null) {</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;      }
<b class="nc">&nbsp;      for (String name : pageStyleCon.getElementNames()) {</b>
<b class="nc">&nbsp;        XPropertySet xPageStandardProps = UnoRuntime.queryInterface(XPropertySet.class, pageStyleCon.getByName(name));</b>
<b class="nc">&nbsp;        if (xPageStandardProps != null) {</b>
<b class="nc">&nbsp;          propertySets.add(UnoRuntime.queryInterface(XPropertySet.class, xPageStandardProps));</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      return propertySets;</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return null;           // Return null as method failed</b>
&nbsp;    }
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * Returns all paragraphs of headers and footers of a document
&nbsp;   */
&nbsp;  public DocumentText getTextOfAllHeadersAndFooters() {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      List&lt;String&gt; sText = new ArrayList&lt;String&gt;();</b>
<b class="nc">&nbsp;      List&lt;Integer&gt; headingNumbers = new ArrayList&lt;Integer&gt;();</b>
<b class="nc">&nbsp;      List&lt;Integer&gt; sortedTextIds = null;</b>
<b class="nc">&nbsp;      List&lt;List&lt;Integer&gt;&gt; deletedCharacters = new ArrayList&lt;List&lt;Integer&gt;&gt;();</b>
<b class="nc">&nbsp;      List&lt;XPropertySet&gt; xPagePropertySets = getPagePropertySets();</b>
<b class="nc">&nbsp;      if (xPagePropertySets != null) {</b>
<b class="nc">&nbsp;        for (XPropertySet xPagePropertySet : xPagePropertySets) {</b>
<b class="nc">&nbsp;          if (xPagePropertySet != null) {</b>
<b class="nc">&nbsp;            boolean headerIsOn = OfficeTools.getBooleanValue(xPagePropertySet.getPropertyValue(&quot;HeaderIsOn&quot;));</b>
<b class="nc">&nbsp;            boolean firstIsShared = OfficeTools.getBooleanValue(xPagePropertySet.getPropertyValue(&quot;FirstIsShared&quot;));</b>
<b class="nc">&nbsp;            boolean headerIsShared = OfficeTools.getBooleanValue(xPagePropertySet.getPropertyValue(&quot;HeaderIsShared&quot;));</b>
<b class="nc">&nbsp;            boolean footerIsOn = OfficeTools.getBooleanValue(xPagePropertySet.getPropertyValue(&quot;FooterIsOn&quot;));</b>
<b class="nc">&nbsp;            boolean footerIsShared = OfficeTools.getBooleanValue(xPagePropertySet.getPropertyValue(&quot;FooterIsShared&quot;));</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; HeaderFooterTypes.length; i++) {</b>
<b class="nc">&nbsp;              if ((headerIsOn &amp;&amp; ((i == 0 &amp;&amp; headerIsShared) </b>
&nbsp;                  || ((i == 1 || i == 2) &amp;&amp; !headerIsShared)
&nbsp;                  || (i == 3 &amp;&amp; !firstIsShared)))
&nbsp;                  || (footerIsOn &amp;&amp; ((i == 4 &amp;&amp; footerIsShared) 
&nbsp;                      || ((i == 5 || i == 6) &amp;&amp; !footerIsShared)
&nbsp;                      || (i == 7 &amp;&amp; !firstIsShared)))) {
<b class="nc">&nbsp;                XText xHeaderText = UnoRuntime.queryInterface(XText.class, xPagePropertySet.getPropertyValue(HeaderFooterTypes[i]));</b>
<b class="nc">&nbsp;                if (xHeaderText != null &amp;&amp; !xHeaderText.getString().isEmpty()) {</b>
<b class="nc">&nbsp;                  if (!headingNumbers.contains(sText.size())) {</b>
<b class="nc">&nbsp;                    headingNumbers.add(sText.size());</b>
&nbsp;                  }
<b class="nc">&nbsp;                  sortedTextIds = addAllParagraphsOfText(xHeaderText, sText, deletedCharacters, sortedTextIds);</b>
&nbsp;                }
&nbsp;              }
&nbsp;            }
&nbsp;          }
<b class="nc">&nbsp;        }</b>
&nbsp;      }
<b class="nc">&nbsp;      return new DocumentText(sText, headingNumbers, new ArrayList&lt;Integer&gt;(), sortedTextIds, deletedCharacters);</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return null;           // Return null as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;
&nbsp;  /** 
&nbsp;   * Returns the number of paragraphs of headers and footers of a document
&nbsp;   */
&nbsp;  public int getNumberOfAllHeadersAndFooters() {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      int num = 0;</b>
<b class="nc">&nbsp;      List&lt;XPropertySet&gt; xPagePropertySets = getPagePropertySets();</b>
<b class="nc">&nbsp;      if (xPagePropertySets != null) {</b>
<b class="nc">&nbsp;        for (XPropertySet xPagePropertySet : xPagePropertySets) {</b>
<b class="nc">&nbsp;          if (xPagePropertySet != null) {</b>
<b class="nc">&nbsp;            boolean headerIsOn = OfficeTools.getBooleanValue(xPagePropertySet.getPropertyValue(&quot;HeaderIsOn&quot;));</b>
<b class="nc">&nbsp;            boolean firstIsShared = OfficeTools.getBooleanValue(xPagePropertySet.getPropertyValue(&quot;FirstIsShared&quot;));</b>
<b class="nc">&nbsp;            boolean headerIsShared = OfficeTools.getBooleanValue(xPagePropertySet.getPropertyValue(&quot;HeaderIsShared&quot;));</b>
<b class="nc">&nbsp;            boolean footerIsOn = OfficeTools.getBooleanValue(xPagePropertySet.getPropertyValue(&quot;FooterIsOn&quot;));</b>
<b class="nc">&nbsp;            boolean footerIsShared = OfficeTools.getBooleanValue(xPagePropertySet.getPropertyValue(&quot;FooterIsShared&quot;));</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; HeaderFooterTypes.length; i++) {</b>
<b class="nc">&nbsp;              if ((headerIsOn &amp;&amp; ((i == 0 &amp;&amp; headerIsShared) </b>
&nbsp;                  || ((i == 1 || i == 2) &amp;&amp; !headerIsShared)
&nbsp;                  || (i == 3 &amp;&amp; !firstIsShared)))
&nbsp;                  || (footerIsOn &amp;&amp; ((i == 4 &amp;&amp; footerIsShared) 
&nbsp;                      || ((i == 5 || i == 6) &amp;&amp; !footerIsShared)
&nbsp;                      || (i == 7 &amp;&amp; !firstIsShared)))) {
<b class="nc">&nbsp;                XText xHeaderText = UnoRuntime.queryInterface(XText.class, xPagePropertySet.getPropertyValue(HeaderFooterTypes[i]));</b>
<b class="nc">&nbsp;                if (xHeaderText != null &amp;&amp; !xHeaderText.getString().isEmpty()) {</b>
<b class="nc">&nbsp;                  num += getNumberOfAllParagraphsOfText(xHeaderText);</b>
&nbsp;                }
&nbsp;              }
&nbsp;            }
&nbsp;          }
<b class="nc">&nbsp;        }</b>
&nbsp;      }
<b class="nc">&nbsp;      return num;</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return 0;           // Return 0 as method failed</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;
&nbsp;  /** 
&nbsp;   * get the paragraph cursor
&nbsp;   */
&nbsp;  public XParagraphCursor getParagraphCursor(TextParagraph textPara) {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      int type = textPara.type;</b>
<b class="nc">&nbsp;      int number = textPara.number;</b>
<b class="nc">&nbsp;      int nPara = 0;</b>
<b class="nc">&nbsp;      if (type == DocumentCache.CURSOR_TYPE_UNKNOWN) {</b>
<b class="nc">&nbsp;        return null;</b>
<b class="nc">&nbsp;      } else if (type == DocumentCache.CURSOR_TYPE_TEXT) {</b>
<b class="nc">&nbsp;        if (xPCursor == null) {</b>
<b class="nc">&nbsp;          return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        xPCursor.gotoStart(false);</b>
<b class="nc">&nbsp;        while (nPara &lt; number &amp;&amp; xPCursor.gotoNextParagraph(false)) nPara++;</b>
<b class="nc">&nbsp;        return xPCursor;</b>
<b class="nc">&nbsp;      } else if (type == DocumentCache.CURSOR_TYPE_TABLE) {</b>
<b class="nc">&nbsp;        XTextTablesSupplier xTableSupplier = UnoRuntime.queryInterface(XTextTablesSupplier.class, curDoc);</b>
<b class="nc">&nbsp;        XIndexAccess xTables = UnoRuntime.queryInterface(XIndexAccess.class, xTableSupplier.getTextTables());</b>
<b class="nc">&nbsp;        if (xTables != null) {</b>
<b class="nc">&nbsp;          for (int i = 0; i &lt; xTables.getCount(); i++) {</b>
<b class="nc">&nbsp;            XTextTable xTable = UnoRuntime.queryInterface(XTextTable.class, xTables.getByIndex(i));</b>
<b class="nc">&nbsp;            for (String cellName : xTable.getCellNames()) {</b>
<b class="nc">&nbsp;              XText xTableText = UnoRuntime.queryInterface(XText.class, xTable.getCellByName(cellName) );</b>
<b class="nc">&nbsp;              XTextCursor xTextCursor = xTableText.createTextCursor();</b>
<b class="nc">&nbsp;              XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;              xParagraphCursor.gotoStart(false);</b>
<b class="nc">&nbsp;              while (nPara &lt; number &amp;&amp; xParagraphCursor.gotoNextParagraph(false)){</b>
<b class="nc">&nbsp;                nPara++;</b>
&nbsp;              }
<b class="nc">&nbsp;              if (nPara == number) {</b>
<b class="nc">&nbsp;                return xParagraphCursor;</b>
&nbsp;              }
<b class="nc">&nbsp;              nPara++;</b>
&nbsp;            }
&nbsp;          }
&nbsp;        }
<b class="nc">&nbsp;      } else if (type == DocumentCache.CURSOR_TYPE_FOOTNOTE) {</b>
<b class="nc">&nbsp;        XFootnotesSupplier xFootnoteSupplier = UnoRuntime.queryInterface(XFootnotesSupplier.class, curDoc );</b>
<b class="nc">&nbsp;        XIndexAccess xFootnotes = UnoRuntime.queryInterface(XIndexAccess.class, xFootnoteSupplier.getFootnotes());</b>
<b class="nc">&nbsp;        if (xFootnotes != null) {</b>
<b class="nc">&nbsp;          for (int i = 0; i &lt; xFootnotes.getCount(); i++) {</b>
<b class="nc">&nbsp;            XFootnote XFootnote = UnoRuntime.queryInterface(XFootnote.class, xFootnotes.getByIndex(i));</b>
<b class="nc">&nbsp;            XText xFootnoteText = UnoRuntime.queryInterface(XText.class, XFootnote);</b>
<b class="nc">&nbsp;            XTextCursor xTextCursor = xFootnoteText.createTextCursor();</b>
<b class="nc">&nbsp;            XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;            xParagraphCursor.gotoStart(false);</b>
<b class="nc">&nbsp;            while (nPara &lt; number &amp;&amp; xParagraphCursor.gotoNextParagraph(false)){</b>
<b class="nc">&nbsp;              nPara++;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (nPara == number) {</b>
<b class="nc">&nbsp;              return xParagraphCursor;</b>
&nbsp;            }
<b class="nc">&nbsp;            nPara++;</b>
&nbsp;          }
&nbsp;        }
<b class="nc">&nbsp;      } else if (type == DocumentCache.CURSOR_TYPE_ENDNOTE) {</b>
<b class="nc">&nbsp;        XEndnotesSupplier xEndnotesSupplier = UnoRuntime.queryInterface(XEndnotesSupplier.class, curDoc );</b>
<b class="nc">&nbsp;        XIndexAccess xEndnotes = UnoRuntime.queryInterface(XIndexAccess.class, xEndnotesSupplier.getEndnotes());</b>
<b class="nc">&nbsp;        if (xEndnotes != null) {</b>
<b class="nc">&nbsp;          for (int i = 0; i &lt; xEndnotes.getCount(); i++) {</b>
<b class="nc">&nbsp;            XFootnote xEndnote = UnoRuntime.queryInterface(XFootnote.class, xEndnotes.getByIndex(i));</b>
<b class="nc">&nbsp;            XText xEndnoteText = UnoRuntime.queryInterface(XText.class, xEndnote);</b>
<b class="nc">&nbsp;            XTextCursor xTextCursor = xEndnoteText.createTextCursor();</b>
<b class="nc">&nbsp;            XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;            xParagraphCursor.gotoStart(false);</b>
<b class="nc">&nbsp;            while (nPara &lt; number &amp;&amp; xParagraphCursor.gotoNextParagraph(false)){</b>
<b class="nc">&nbsp;              nPara++;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (nPara == number) {</b>
<b class="nc">&nbsp;              return xParagraphCursor;</b>
&nbsp;            }
<b class="nc">&nbsp;            nPara++;</b>
&nbsp;          }
&nbsp;        }
<b class="nc">&nbsp;      } else if (type == DocumentCache.CURSOR_TYPE_HEADER_FOOTER) {</b>
<b class="nc">&nbsp;        List&lt;XPropertySet&gt; xPagePropertySets = getPagePropertySets();</b>
<b class="nc">&nbsp;        XText lastHeaderText = null;</b>
<b class="nc">&nbsp;        for (XPropertySet xPagePropertySet : xPagePropertySets) {</b>
<b class="nc">&nbsp;          if (xPagePropertySet != null) {</b>
<b class="nc">&nbsp;            for (String headerFooter : DocumentCursorTools.HeaderFooterTypes) {</b>
<b class="nc">&nbsp;              XText xHeaderText = UnoRuntime.queryInterface(XText.class, xPagePropertySet.getPropertyValue(headerFooter));</b>
<b class="nc">&nbsp;              if (xHeaderText != null &amp;&amp; !xHeaderText.getString().isEmpty() &amp;&amp; (lastHeaderText == null || !lastHeaderText.equals(xHeaderText))) {</b>
<b class="nc">&nbsp;                XTextCursor xTextCursor = xHeaderText.createTextCursor();</b>
<b class="nc">&nbsp;                XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;                xParagraphCursor.gotoStart(false);</b>
<b class="nc">&nbsp;                while (nPara &lt; number &amp;&amp; xParagraphCursor.gotoNextParagraph(false)){</b>
<b class="nc">&nbsp;                  nPara++;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (nPara == number) {</b>
<b class="nc">&nbsp;                  return xParagraphCursor;</b>
&nbsp;                }
<b class="nc">&nbsp;                nPara++;</b>
<b class="nc">&nbsp;                lastHeaderText = xHeaderText;</b>
&nbsp;              }
&nbsp;            }
&nbsp;          }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;      } else if (type == DocumentCache.CURSOR_TYPE_SHAPE) {</b>
<b class="nc">&nbsp;        XDrawPageSupplier xDrawPageSupplier = UnoRuntime.queryInterface(XDrawPageSupplier.class, curDoc);</b>
<b class="nc">&nbsp;        if (xDrawPageSupplier != null) {</b>
<b class="nc">&nbsp;          XDrawPage xDrawPage = xDrawPageSupplier.getDrawPage();</b>
<b class="nc">&nbsp;          if (xDrawPage != null) {</b>
<b class="nc">&nbsp;            XShapes xShapes = UnoRuntime.queryInterface(XShapes.class, xDrawPage);</b>
<b class="nc">&nbsp;            int nShapes = xShapes.getCount();</b>
<b class="nc">&nbsp;            for(int j = 0; j &lt; nShapes; j++) {</b>
<b class="nc">&nbsp;              Object oShape = xShapes.getByIndex(j);</b>
<b class="nc">&nbsp;              XShape xShape = UnoRuntime.queryInterface(XShape.class, oShape);</b>
<b class="nc">&nbsp;              if (xShape != null) {</b>
<b class="nc">&nbsp;                XText xShapeText = UnoRuntime.queryInterface(XText.class, xShape);</b>
<b class="nc">&nbsp;                if (xShapeText != null) {</b>
<b class="nc">&nbsp;                  XTextCursor xTextCursor = xShapeText.createTextCursor();</b>
<b class="nc">&nbsp;                  XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;                  xParagraphCursor.gotoStart(false);</b>
<b class="nc">&nbsp;                  while (nPara &lt; number &amp;&amp; xParagraphCursor.gotoNextParagraph(false)){</b>
<b class="nc">&nbsp;                    nPara++;</b>
&nbsp;                  }
<b class="nc">&nbsp;                  if (nPara == number) {</b>
<b class="nc">&nbsp;                    return xParagraphCursor;</b>
&nbsp;                  }
<b class="nc">&nbsp;                  nPara++;</b>
&nbsp;                }
&nbsp;              }
&nbsp;            }
&nbsp;          }
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
<b class="nc">&nbsp;    return null;</b>
&nbsp;  }
&nbsp;  
&nbsp;  /** 
&nbsp;   * remove marks of text paragraph
&nbsp;   */
&nbsp;  public void removeMarks(List&lt;TextParagraph&gt; textParas) {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      List&lt;List&lt;Integer&gt;&gt; paras = new ArrayList&lt;List&lt;Integer&gt;&gt;();</b>
<b class="nc">&nbsp;      for (int n = 0; n &lt; DocumentCache.NUMBER_CURSOR_TYPES; n++) {</b>
<b class="nc">&nbsp;        paras.add(new ArrayList&lt;Integer&gt;());</b>
&nbsp;      }
<b class="nc">&nbsp;      for (int i = 0; i &lt; textParas.size(); i++) {</b>
<b class="nc">&nbsp;        int type = textParas.get(i).type;</b>
<b class="nc">&nbsp;        if (type &gt;= 0 &amp;&amp; type &lt; DocumentCache.NUMBER_CURSOR_TYPES) {</b>
<b class="nc">&nbsp;          paras.get(type).add(textParas.get(i).number);</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      for (int n = 0; n &lt; DocumentCache.NUMBER_CURSOR_TYPES; n++) {</b>
<b class="nc">&nbsp;        if (!paras.get(n).isEmpty()) {</b>
<b class="nc">&nbsp;          paras.get(n).sort(null);</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      for (int type = 0; type &lt; DocumentCache.NUMBER_CURSOR_TYPES; type++) {</b>
<b class="nc">&nbsp;        if (paras.get(type).size() &gt; 0) {</b>
<b class="nc">&nbsp;          int nPara = 0;</b>
<b class="nc">&nbsp;          if (type == DocumentCache.CURSOR_TYPE_TEXT) {</b>
<b class="nc">&nbsp;            if (xPCursor == null) {</b>
<b class="nc">&nbsp;              break;</b>
&nbsp;            }
<b class="nc">&nbsp;            xPCursor.gotoStart(false);</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; paras.get(type).size(); i++) {</b>
<b class="nc">&nbsp;              int number = paras.get(type).get(i);</b>
<b class="nc">&nbsp;              while (nPara &lt; number &amp;&amp; xPCursor.gotoNextParagraph(false)) {</b>
<b class="nc">&nbsp;                nPara++;</b>
&nbsp;              }
<b class="nc">&nbsp;              if (xPCursor != null) {</b>
<b class="nc">&nbsp;                XMarkingAccess xMarkingAccess = UnoRuntime.queryInterface(XMarkingAccess.class, xPCursor);</b>
<b class="nc">&nbsp;                if (xMarkingAccess == null) {</b>
<b class="nc">&nbsp;                  MessageHandler.printToLogFile(&quot;FlatParagraphTools: addMarksToOneParagraph: xMarkingAccess == null&quot;);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                  xMarkingAccess.invalidateMarkings(TextMarkupType.PROOFREADING);</b>
&nbsp;                }
&nbsp;              }
&nbsp;            }
<b class="nc">&nbsp;          } else if (type == DocumentCache.CURSOR_TYPE_TABLE) {</b>
<b class="nc">&nbsp;            XTextTablesSupplier xTableSupplier = UnoRuntime.queryInterface(XTextTablesSupplier.class, curDoc);</b>
<b class="nc">&nbsp;            XIndexAccess xTables = UnoRuntime.queryInterface(XIndexAccess.class, xTableSupplier.getTextTables());</b>
<b class="nc">&nbsp;            if (xTables != null) {</b>
<b class="nc">&nbsp;              int j = 0;</b>
<b class="nc">&nbsp;              int number = paras.get(type).get(j);</b>
<b class="nc">&nbsp;              for (int i = 0; i &lt; xTables.getCount() &amp;&amp; j &lt; paras.get(type).size(); i++) {</b>
<b class="nc">&nbsp;                XTextTable xTable = UnoRuntime.queryInterface(XTextTable.class, xTables.getByIndex(i));</b>
<b class="nc">&nbsp;                for (String cellName : xTable.getCellNames()) {</b>
<b class="nc">&nbsp;                  XText xTableText = UnoRuntime.queryInterface(XText.class, xTable.getCellByName(cellName) );</b>
<b class="nc">&nbsp;                  XTextCursor xTextCursor = xTableText.createTextCursor();</b>
<b class="nc">&nbsp;                  XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;                  xParagraphCursor.gotoStart(false);</b>
&nbsp;                  do {
<b class="nc">&nbsp;                    if (nPara == number) {</b>
<b class="nc">&nbsp;                      XMarkingAccess xMarkingAccess = UnoRuntime.queryInterface(XMarkingAccess.class, xParagraphCursor);</b>
<b class="nc">&nbsp;                      if (xMarkingAccess == null) {</b>
<b class="nc">&nbsp;                        MessageHandler.printToLogFile(&quot;FlatParagraphTools: addMarksToOneParagraph: xMarkingAccess == null&quot;);</b>
&nbsp;                      } else {
<b class="nc">&nbsp;                        xMarkingAccess.invalidateMarkings(TextMarkupType.PROOFREADING);</b>
&nbsp;                      }
<b class="nc">&nbsp;                      j++;</b>
<b class="nc">&nbsp;                      if (j &lt; paras.get(type).size()) {</b>
<b class="nc">&nbsp;                        number = paras.get(type).get(j);</b>
&nbsp;                      }
&nbsp;                    }
<b class="nc">&nbsp;                    nPara++;</b>
<b class="nc">&nbsp;                  } while (j &lt; paras.get(type).size() &amp;&amp; xParagraphCursor.gotoNextParagraph(false));</b>
<b class="nc">&nbsp;                  if (j == paras.get(type).size()) {</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                  }
&nbsp;                }
&nbsp;              }
&nbsp;            }
<b class="nc">&nbsp;          } else if (type == DocumentCache.CURSOR_TYPE_FOOTNOTE) {</b>
<b class="nc">&nbsp;            XFootnotesSupplier xFootnoteSupplier = UnoRuntime.queryInterface(XFootnotesSupplier.class, curDoc );</b>
<b class="nc">&nbsp;            XIndexAccess xFootnotes = UnoRuntime.queryInterface(XIndexAccess.class, xFootnoteSupplier.getFootnotes());</b>
<b class="nc">&nbsp;            if (xFootnotes != null) {</b>
<b class="nc">&nbsp;              int j = 0;</b>
<b class="nc">&nbsp;              int number = paras.get(type).get(j);</b>
<b class="nc">&nbsp;              for (int i = 0; i &lt; xFootnotes.getCount() &amp;&amp; j &lt; paras.get(type).size(); i++) {</b>
<b class="nc">&nbsp;                XFootnote XFootnote = UnoRuntime.queryInterface(XFootnote.class, xFootnotes.getByIndex(i));</b>
<b class="nc">&nbsp;                XText xFootnoteText = UnoRuntime.queryInterface(XText.class, XFootnote);</b>
<b class="nc">&nbsp;                XTextCursor xTextCursor = xFootnoteText.createTextCursor();</b>
<b class="nc">&nbsp;                XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;                xParagraphCursor.gotoStart(false);</b>
&nbsp;                do {
<b class="nc">&nbsp;                  if (nPara == number) {</b>
<b class="nc">&nbsp;                    XMarkingAccess xMarkingAccess = UnoRuntime.queryInterface(XMarkingAccess.class, xParagraphCursor);</b>
<b class="nc">&nbsp;                    if (xMarkingAccess == null) {</b>
<b class="nc">&nbsp;                      MessageHandler.printToLogFile(&quot;FlatParagraphTools: addMarksToOneParagraph: xMarkingAccess == null&quot;);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                      xMarkingAccess.invalidateMarkings(TextMarkupType.PROOFREADING);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    j++;</b>
<b class="nc">&nbsp;                    if (j &lt; paras.get(type).size()) {</b>
<b class="nc">&nbsp;                      number = paras.get(type).get(j);</b>
&nbsp;                    }
&nbsp;                  }
<b class="nc">&nbsp;                  nPara++;</b>
<b class="nc">&nbsp;                } while (j &lt; paras.get(type).size() &amp;&amp; xParagraphCursor.gotoNextParagraph(false));</b>
&nbsp;              }
&nbsp;            }
<b class="nc">&nbsp;          } else if (type == DocumentCache.CURSOR_TYPE_ENDNOTE) {</b>
<b class="nc">&nbsp;            XEndnotesSupplier xEndnotesSupplier = UnoRuntime.queryInterface(XEndnotesSupplier.class, curDoc );</b>
<b class="nc">&nbsp;            XIndexAccess xEndnotes = UnoRuntime.queryInterface(XIndexAccess.class, xEndnotesSupplier.getEndnotes());</b>
<b class="nc">&nbsp;            if (xEndnotes != null) {</b>
<b class="nc">&nbsp;              int j = 0;</b>
<b class="nc">&nbsp;              int number = paras.get(type).get(j);</b>
<b class="nc">&nbsp;              for (int i = 0; i &lt; xEndnotes.getCount() &amp;&amp; j &lt; paras.get(type).size(); i++) {</b>
<b class="nc">&nbsp;                XFootnote xEndnote = UnoRuntime.queryInterface(XFootnote.class, xEndnotes.getByIndex(i));</b>
<b class="nc">&nbsp;                XText xEndnoteText = UnoRuntime.queryInterface(XText.class, xEndnote);</b>
<b class="nc">&nbsp;                XTextCursor xTextCursor = xEndnoteText.createTextCursor();</b>
<b class="nc">&nbsp;                XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;                xParagraphCursor.gotoStart(false);</b>
&nbsp;                do {
<b class="nc">&nbsp;                  if (nPara == number) {</b>
<b class="nc">&nbsp;                    XMarkingAccess xMarkingAccess = UnoRuntime.queryInterface(XMarkingAccess.class, xParagraphCursor);</b>
<b class="nc">&nbsp;                    if (xMarkingAccess == null) {</b>
<b class="nc">&nbsp;                      MessageHandler.printToLogFile(&quot;FlatParagraphTools: addMarksToOneParagraph: xMarkingAccess == null&quot;);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                      xMarkingAccess.invalidateMarkings(TextMarkupType.PROOFREADING);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    j++;</b>
<b class="nc">&nbsp;                    if (j &lt; paras.get(type).size()) {</b>
<b class="nc">&nbsp;                      number = paras.get(type).get(j);</b>
&nbsp;                    }
&nbsp;                  }
<b class="nc">&nbsp;                  nPara++;</b>
<b class="nc">&nbsp;                } while (j &lt; paras.get(type).size() &amp;&amp; xParagraphCursor.gotoNextParagraph(false));</b>
&nbsp;              }
&nbsp;            }
<b class="nc">&nbsp;          } else if (type == DocumentCache.CURSOR_TYPE_HEADER_FOOTER) {</b>
<b class="nc">&nbsp;            List&lt;XPropertySet&gt; xPagePropertySets = getPagePropertySets();</b>
<b class="nc">&nbsp;            XText lastHeaderText = null;</b>
<b class="nc">&nbsp;            int j = 0;</b>
<b class="nc">&nbsp;            int number = paras.get(type).get(j);</b>
<b class="nc">&nbsp;            for (XPropertySet xPagePropertySet : xPagePropertySets) {</b>
<b class="nc">&nbsp;              if (xPagePropertySet != null) {</b>
<b class="nc">&nbsp;                for (String headerFooter : DocumentCursorTools.HeaderFooterTypes) {</b>
<b class="nc">&nbsp;                  XText xHeaderText = UnoRuntime.queryInterface(XText.class, xPagePropertySet.getPropertyValue(headerFooter));</b>
<b class="nc">&nbsp;                  if (xHeaderText != null &amp;&amp; !xHeaderText.getString().isEmpty() &amp;&amp; (lastHeaderText == null || !lastHeaderText.equals(xHeaderText))) {</b>
<b class="nc">&nbsp;                    XTextCursor xTextCursor = xHeaderText.createTextCursor();</b>
<b class="nc">&nbsp;                    XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;                    xParagraphCursor.gotoStart(false);</b>
&nbsp;                    do {
<b class="nc">&nbsp;                      if (nPara == number) {</b>
<b class="nc">&nbsp;                        XMarkingAccess xMarkingAccess = UnoRuntime.queryInterface(XMarkingAccess.class, xParagraphCursor);</b>
<b class="nc">&nbsp;                        if (xMarkingAccess == null) {</b>
<b class="nc">&nbsp;                          MessageHandler.printToLogFile(&quot;FlatParagraphTools: addMarksToOneParagraph: xMarkingAccess == null&quot;);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                          xMarkingAccess.invalidateMarkings(TextMarkupType.PROOFREADING);</b>
&nbsp;                        }
<b class="nc">&nbsp;                        j++;</b>
<b class="nc">&nbsp;                        if (j &lt; paras.get(type).size()) {</b>
<b class="nc">&nbsp;                          number = paras.get(type).get(j);</b>
&nbsp;                        }
&nbsp;                      }
<b class="nc">&nbsp;                      nPara++;</b>
<b class="nc">&nbsp;                    } while (j &lt; paras.get(type).size() &amp;&amp; xParagraphCursor.gotoNextParagraph(false));</b>
<b class="nc">&nbsp;                    lastHeaderText = xHeaderText;</b>
&nbsp;                  }
<b class="nc">&nbsp;                  if (j == paras.get(type).size()) {</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                  }
&nbsp;                }
&nbsp;              }
<b class="nc">&nbsp;              if (j == paras.get(type).size()) {</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;              }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;          } else if (type == DocumentCache.CURSOR_TYPE_SHAPE) {</b>
<b class="nc">&nbsp;            XDrawPageSupplier xDrawPageSupplier = UnoRuntime.queryInterface(XDrawPageSupplier.class, curDoc);</b>
<b class="nc">&nbsp;            if (xDrawPageSupplier != null) {</b>
<b class="nc">&nbsp;              XDrawPage xDrawPage = xDrawPageSupplier.getDrawPage();</b>
<b class="nc">&nbsp;              if (xDrawPage != null) {</b>
<b class="nc">&nbsp;                XShapes xShapes = UnoRuntime.queryInterface(XShapes.class, xDrawPage);</b>
<b class="nc">&nbsp;                int nShapes = xShapes.getCount();</b>
<b class="nc">&nbsp;                int j = 0;</b>
<b class="nc">&nbsp;                int number = paras.get(type).get(j);</b>
<b class="nc">&nbsp;                for(int i = 0; i &lt; nShapes &amp;&amp; j &lt; paras.get(type).size(); i++) {</b>
<b class="nc">&nbsp;                  Object oShape = xShapes.getByIndex(i);</b>
<b class="nc">&nbsp;                  XShape xShape = UnoRuntime.queryInterface(XShape.class, oShape);</b>
<b class="nc">&nbsp;                  if (xShape != null) {</b>
<b class="nc">&nbsp;                    XText xShapeText = UnoRuntime.queryInterface(XText.class, xShape);</b>
<b class="nc">&nbsp;                    if (xShapeText != null) {</b>
<b class="nc">&nbsp;                      XTextCursor xTextCursor = xShapeText.createTextCursor();</b>
<b class="nc">&nbsp;                      XParagraphCursor xParagraphCursor = UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);</b>
<b class="nc">&nbsp;                      if (xParagraphCursor != null) {</b>
<b class="nc">&nbsp;                        xParagraphCursor.gotoStart(false);</b>
&nbsp;                        do {
<b class="nc">&nbsp;                          if (nPara == number) {</b>
<b class="nc">&nbsp;                            XMarkingAccess xMarkingAccess = UnoRuntime.queryInterface(XMarkingAccess.class, xParagraphCursor);</b>
<b class="nc">&nbsp;                            if (xMarkingAccess == null) {</b>
<b class="nc">&nbsp;                              MessageHandler.printToLogFile(&quot;FlatParagraphTools: addMarksToOneParagraph: xMarkingAccess == null&quot;);</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                              xMarkingAccess.invalidateMarkings(TextMarkupType.PROOFREADING);</b>
&nbsp;                            }
<b class="nc">&nbsp;                            j++;</b>
<b class="nc">&nbsp;                            if (j &lt; paras.get(type).size()) {</b>
<b class="nc">&nbsp;                              number = paras.get(type).get(j);</b>
&nbsp;                            }
&nbsp;                          }
<b class="nc">&nbsp;                          nPara++;</b>
<b class="nc">&nbsp;                        } while (j &lt; paras.get(type).size() &amp;&amp; xParagraphCursor.gotoNextParagraph(false));</b>
&nbsp;                      }
&nbsp;                    }
&nbsp;                  }
&nbsp;                }
&nbsp;              }
&nbsp;            }
&nbsp;          }
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /**
&nbsp;   * get positions of deleted characters from a text paragraph
&nbsp;   */
&nbsp;  public List&lt;Integer&gt; getDeletedCharactersOfTextParagraph(TextParagraph textPara) {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      XParagraphCursor xPCursor = getParagraphCursor(textPara);</b>
<b class="nc">&nbsp;      if (xPCursor == null) {</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;      }
<b class="nc">&nbsp;      xPCursor.gotoStartOfParagraph(false);</b>
<b class="nc">&nbsp;      xPCursor.gotoEndOfParagraph(true);</b>
<b class="nc">&nbsp;      return getDeletedCharacters(xPCursor);</b>
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
<b class="nc">&nbsp;      return null;</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;  }
&nbsp;  
&nbsp;  /**
&nbsp;   * is protected character at position in paragraph
&nbsp;   */
&nbsp;  public boolean isProtectedCharacter(TextParagraph textPara, short x) {
<b class="nc">&nbsp;    isBusy++;</b>
&nbsp;    try {
<b class="nc">&nbsp;      XParagraphCursor xPCursor = getParagraphCursor(textPara);</b>
<b class="nc">&nbsp;      if (xPCursor == null) {</b>
<b class="nc">&nbsp;        return false;</b>
&nbsp;      }
<b class="nc">&nbsp;      xPCursor.gotoStartOfParagraph(false);</b>
<b class="nc">&nbsp;      xPCursor.goRight(x, false);</b>
<b class="nc">&nbsp;      XPropertySet xParagraphPropertySet = UnoRuntime.queryInterface(XPropertySet.class, xPCursor.getStart());</b>
<b class="nc">&nbsp;      XTextSection xTextSection = UnoRuntime.queryInterface(XTextSection.class, xParagraphPropertySet.getPropertyValue(&quot;TextSection&quot;));</b>
<b class="nc">&nbsp;      xParagraphPropertySet = UnoRuntime.queryInterface(XPropertySet.class, xTextSection);</b>
<b class="nc">&nbsp;      if(xParagraphPropertySet != null &amp;&amp; (boolean) xParagraphPropertySet.getPropertyValue(&quot;IsProtected&quot;)) {</b>
<b class="nc">&nbsp;        return true;</b>
&nbsp;      }
<b class="nc">&nbsp;    } catch (Throwable t) {</b>
<b class="nc">&nbsp;      MessageHandler.printException(t);     // all Exceptions thrown by UnoRuntime.queryInterface are caught and printed to log file</b>
&nbsp;    } finally {
<b class="nc">&nbsp;      isBusy--;</b>
<b class="nc">&nbsp;    }</b>
<b class="nc">&nbsp;    return false;</b>
&nbsp;  }
&nbsp;  
&nbsp;  /**
&nbsp;   *  Returns the status of cursor tools
&nbsp;   *  true: If a cursor tool in one or more threads is active
&nbsp;   */
&nbsp;  public static boolean isBusy() {
<b class="nc">&nbsp;    return isBusy &gt; 0;</b>
&nbsp;  }
&nbsp;  
&nbsp;  /**
&nbsp;   * Class to give back the text and the headings under the specified cursor
&nbsp;   */
&nbsp;  public static class DocumentText {
&nbsp;    List&lt;String&gt; paragraphs;
&nbsp;    List&lt;Integer&gt; headingNumbers;
&nbsp;    List&lt;Integer&gt; automaticTextParagraphs;
&nbsp;    List&lt;Integer&gt; sortedTextIds;
&nbsp;    List&lt;List&lt;Integer&gt;&gt; deletedCharacters;
&nbsp;    
<b class="nc">&nbsp;    DocumentText() {</b>
<b class="nc">&nbsp;      this.paragraphs = new ArrayList&lt;String&gt;();</b>
<b class="nc">&nbsp;      this.headingNumbers = new ArrayList&lt;Integer&gt;();</b>
<b class="nc">&nbsp;      this.automaticTextParagraphs = new ArrayList&lt;Integer&gt;();</b>
<b class="nc">&nbsp;      this.sortedTextIds = null;</b>
<b class="nc">&nbsp;      this.deletedCharacters = new ArrayList&lt;List&lt;Integer&gt;&gt;();</b>
&nbsp;    }
&nbsp;    
&nbsp;    DocumentText(List&lt;String&gt; paragraphs, List&lt;Integer&gt; headingNumbers, List&lt;Integer&gt; automaticTextParagraphs, 
<b class="nc">&nbsp;        List&lt;Integer&gt; sortedTextIds, List&lt;List&lt;Integer&gt;&gt; deletedCharacters) {</b>
<b class="nc">&nbsp;      this.paragraphs = paragraphs;</b>
<b class="nc">&nbsp;      this.headingNumbers = headingNumbers;</b>
<b class="nc">&nbsp;      this.automaticTextParagraphs = automaticTextParagraphs;</b>
<b class="nc">&nbsp;      this.sortedTextIds = sortedTextIds;</b>
<b class="nc">&nbsp;      this.deletedCharacters = deletedCharacters;</b>
&nbsp;    }
&nbsp;  }
&nbsp;  
&nbsp;}
&nbsp;  
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-02-20 19:41</div>
</div>
</body>
</html>
